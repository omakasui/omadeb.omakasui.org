---
interface Props {
  code: string;
  language?: string;
  copyable?: boolean;
  class?: string;
}

const {
  code,
  language = "bash",
  copyable = true,
  class: className,
} = Astro.props;
const codeId = `code-${Math.random().toString(36).substr(2, 9)}`;
---

<div
  class={`relative mx-0 my-4 flex items-center gap-4 rounded border border-border bg-background-secondary p-4 ${className || ""}`}
  role="group"
  aria-label="Code block"
>
  <code
    id={codeId}
    class="scrollbar-hide text-primary flex flex-1 items-center overflow-x-auto bg-none text-sm whitespace-nowrap"
    aria-label={`${language} code`}
    style="scrollbar-width: none; -ms-overflow-style: none;"
  >
    {code}
  </code>
  {
    copyable && (
      <button
        class="border-border-light bg-border-dark text-foreground-muted hover:bg-border hover:text-foreground-bright ml-4 flex shrink-0 cursor-pointer items-center justify-center rounded border px-4 py-2 text-xs transition-colors"
        data-copy-code={code}
        title="Copy to clipboard"
        aria-label="Copy code to clipboard"
      >
        <i class="nf nf-md-content_copy" />
      </button>
    )
  }
</div>

<script is:inline>
  document.addEventListener("DOMContentLoaded", () => {
    const copyButtons = document.querySelectorAll("[data-copy-code]");
    copyButtons.forEach((button) => {
      button.addEventListener("click", () => {
        const code = button.getAttribute("data-copy-code");
        if (code) {
          navigator.clipboard.writeText(code);
          const icon = button.querySelector("i");
          if (icon) {
            const originalClass = icon.className;
            icon.className = "nf nf-md-check";
            setTimeout(() => {
              icon.className = originalClass;
            }, 2000);
          }
        }
      });
    });
  });
</script>
